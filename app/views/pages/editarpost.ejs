<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vintélo</title>
    <link rel="stylesheet" href="css/editarpost.css">
    <link rel="icon" href="/imagens/brilhoescuro.png" type="image/x-icon">
</head>
<body>
    <header class="mobile-header">
        <a href="/blogadm">
            <img src="imagens/seta.png" alt="Voltar">
        </a>
        <h1>EDITAR <span class="highlight">POST</span></h1>
        <a href="/blogadm">
            <img src="imagens/carrinho.png" alt="Blog">
        </a>
    </header>

    <section class="oculto-mobile">
        <section class="discount-banner">
            <span class="highlight">Painel Administrativo - Editar Post</span>
        </section>
        <header class="main-header">
            <a href="/blogadm">
                <img src="imagens/logo.png" class="img-logo">
            </a>
            <nav>
                <a href="/homeadm">Home Admin</a>
                <a href="/blogadm">Blog</a>
                <a href="/denuncias">Denúncias</a>
                <a href="/avaliacaoadm">Avaliações</a>
            </nav>
            <section class="search-profile">
                <form>
                    <input type="text" placeholder="Buscar posts...">
                </form>
                <ul>
                    <li><a href="/homeadm"><img src="imagens/icone sem cadastro.png" class="maria"></a></li>
                    <li><a href="/homeadm"><img src="imagens/icone saco.png" class="img-tamanho"></a></li>
                    <li><a href="/homeadm"><img src="imagens/icone coraçao.png" class="img-tamanho2"></a></li>
                </ul>
            </section>
        </header>
    </section>

    <main class="edit-container">
        <!-- Mensagens de erro e sucesso -->
        <% if (typeof req !== 'undefined' && req.query && req.query.erro) { %>
        <div class="alert alert-error" style="background-color: #fee; border: 1px solid #fcc; color: #c33; padding: 10px; margin: 10px 0; border-radius: 5px;">
            <strong>Erro:</strong> <%= req.query.erro %>
        </div>
        <% } %>
        
        <% if (typeof req !== 'undefined' && req.query && req.query.sucesso) { %>
        <div class="alert alert-success" style="background-color: #efe; border: 1px solid #cfc; color: #3c3; padding: 10px; margin: 10px 0; border-radius: 5px;">
            <strong>Sucesso:</strong> <%= req.query.sucesso %>
        </div>
        <% } %>
        
        <form class="edit-form" action="/editarpost/<%= typeof artigo !== 'undefined' && artigo ? artigo.ID_ARTIGO : '' %>" method="post" enctype="multipart/form-data">
            <section class="form-header">
                <h2>Editar Artigo</h2>
                <p>Modifique o conteúdo do seu post</p>
                <% if (typeof artigo !== 'undefined' && artigo) { %>
                <p><strong>ID do Artigo:</strong> <%= artigo.ID_ARTIGO %></p>
                <% } %>
            </section>

            <% if (typeof artigo !== 'undefined' && artigo) { %>
            <input type="hidden" name="artigo_id" value="<%= artigo.ID_ARTIGO %>">
            <% } else { %>
            <div class="alert alert-error" style="background-color: #fee; border: 1px solid #fcc; color: #c33; padding: 10px; margin: 10px 0; border-radius: 5px;">
                <strong>Erro:</strong> Artigo não encontrado
            </div>
            <% } %>

            <% if (typeof artigo !== 'undefined' && artigo) { %>
            <section class="form-section">
                <label for="titulo">Título do Artigo</label>
                <input type="text" id="titulo" name="titulo" value="<%= artigo.TITULO || '' %>" required minlength="5">
            </section>

            <section class="form-section">
                <label for="categoria">Categoria</label>
                <select id="categoria" name="categoria" required>
                    <% 
                    const categoriaAtual = artigo.CATEGORIA || 'Moda';
                    %>
                    <option value="Style" <%= categoriaAtual === 'Style' ? 'selected' : '' %>>Style</option>
                    <option value="Moda" <%= categoriaAtual === 'Moda' ? 'selected' : '' %>>Moda</option>
                    <option value="Tendência" <%= categoriaAtual === 'Tendência' ? 'selected' : '' %>>Tendência</option>
                    <option value="Sustentabilidade" <%= categoriaAtual === 'Sustentabilidade' ? 'selected' : '' %>>Sustentabilidade</option>
                    <option value="BOSS" <%= categoriaAtual === 'BOSS' ? 'selected' : '' %>>BOSS</option>
                    <option value="Gucci" <%= categoriaAtual === 'Gucci' ? 'selected' : '' %>>Gucci</option>
                </select>
            </section>
            <% } %>

            <% if (typeof artigo !== 'undefined' && artigo) { %>
            <section class="form-section">
                <label for="autor">Autor</label>
                <input type="text" id="autor" name="autor" value="<%= artigo.AUTOR || 'Vintélo Fashion' %>" readonly>
            </section>

            <section class="form-section">
                <label for="data">Data de Publicação</label>
                <input type="date" id="data" name="data" value="<%= artigo.DT_PUBLICACAO ? new Date(artigo.DT_PUBLICACAO).toISOString().split('T')[0] : '' %>" readonly>
            </section>

            <section class="form-section">
                <label for="resumo">Resumo/Descrição</label>
                <textarea id="resumo" name="resumo" rows="4"><%= artigo.RESUMO || '' %></textarea>
            </section>

            <section class="form-section">
                <label for="conteudo">Conteúdo Principal</label>
                <textarea id="conteudo" name="conteudo" rows="8" required minlength="20"><%= artigo.CONTEUDO || '' %></textarea>
            </section>

            <section class="form-actions">
                <button type="button" class="btn-secondary" onclick="window.location.href='/blogadm'">Cancelar</button>
                <button type="submit" class="btn-primary">Salvar Alterações</button>
            </section>
            <% } else { %>
            <div class="form-actions">
                <button type="button" class="btn-secondary" onclick="window.location.href='/blogadm'">Voltar ao Blog</button>
            </div>
            <% } %>

        </form>
    </main>

    <footer class="footer">
        <img src="imagens/logo_vintélo_clara 1.png" alt="Vintélo" class="footer-image">
        <section class="social-media">
            <p>Siga nossas redes sociais</p>
            <ul class="social-links">
                <li><a href="https://facebook.com" target="_blank" class="social-link">
                    <img src="imagens/Facebook.png" alt="Facebook"></a></li>
                <li><a href="https://pinterest.com" target="_blank" class="social-link">
                    <img src="imagens/Pinterest.png" alt="Pinterest"></a></li>
                <li><a href="https://www.instagram.com/vintelobrechos" target="_blank" class="social-link">
                    <img src="imagens/Instagram.png" alt="Instagram"></a></li>
            </ul>
        </section>
        <p class="copyright">©2024 Vintélo. Todos os direitos reservados.</p>
    </footer>

    <script>
        function previewImage(input, previewId) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById(previewId).src = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        <% if (typeof artigo !== 'undefined' && artigo) { %>
        document.querySelector('.edit-form')?.addEventListener('submit', function(e) {
            const btn = this.querySelector('button[type="submit"]');
            if (btn) {
                btn.disabled = true;
                btn.textContent = 'Salvando...';
            }
        });
        <% } %>
    </script>
    <script src="/js/perfil-autenticado.js"></script>
    <script src="/js/navegacao.js"></script>
</body>
</html>